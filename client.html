<html>
	<head>
		<meta lang="es">
  		<meta charset="utf-8">
		<title>Cliente</title>
		<!-- // <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script> -->
		<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAg6ZY0_8qvH_DSFu5A4wbeZmzqxLQyKss&sensor=false"></script>

		<!-- // <script src="maps.js"></script> -->
		
		<!-- <script>
			var markers = [
		        ['Bondi Beach', -33.890542, 151.274856],
		        ['Coogee Beach', -33.923036, 151.259052],
		        ['Cronulla Beach', -34.028249, 151.157507],
		        ['Manly Beach', -33.80010128657071, 151.28747820854187],
		        ['Maroubra Beach', -33.950198, 151.259302]
		    ];
		
			function initializeMaps() { 
			    var latlng = new google.maps.LatLng(-33.92, 151.25);
			    var myOptions = {
			        zoom: 10,
			        center: latlng,
			        mapTypeId: google.maps.MapTypeId.ROADMAP,
			        mapTypeControl: false
			    };
			    var map = new google.maps.Map(document.getElementById("map-canvas"),myOptions);
			    var infowindow = new google.maps.InfoWindow(), marker, i;
			    for (i = 0; i < markers.length; i++) {  
			        marker = new google.maps.Marker({
			            position: new google.maps.LatLng(markers[i][1], markers[i][2]),
			            map: map
			        });
			        google.maps.event.addListener(marker, 'click', (function(marker, i) {
			            return function() {
			                infowindow.setContent(markers[i][0]);
			                infowindow.open(map, marker);
			            }
			        })(marker, i));
			    }
			}
			google.maps.event.addDomListener(window, 'load', initializeMaps);
		</script>
		 -->
		
		<style>
			dd,dt {
				float:left;
				margin:0;
				padding:5px;
				clear:both;
				display:block;
				width:100%;

			}
			dt {
				background:#ddd;
			}
			time {
				color:gray;
			}
		</style>
	</head>
	

	<body>
	    <div id="map-canvas" style="width:100%; height:100%"></div>

        <time></time>
        <div id="container">Loading ...</div>

        <script src="socket.io/socket.io.js"></script>
    	<script src="http://code.jquery.com/jquery-latest.min.js"></script>

		<script>  
			// create a new websocket
			var socket = io.connect('http://localhost:8000');
			var markers2 = [];

			// on message received we print all the data inside the #container div
			socket.on('notification', function (data) {
			    var usersList = "<dl>";
			    $.each(data.users,function(index,user){
			        usersList += "<dt>" + user.user_name + "</dt>\n" +
			        			 "<dd>" + user.user_lat + "</dd>\n" +
			        			 "<dd>" + user.user_lon + "</dd>\n" +
			                     "<dd>" + user.user_description + "\n" +
			                     "</dd>";
			                     // markers2.push(user.user_name, user.user_lat, user.user_lon);
			                 	 lat = parseFloat (user.user_lat);
			                 	 lng = parseFloat (user.user_lon);
			                 	 ubicacion = new google.maps.LatLng(lat, lng);
			    				 addMarker(ubicacion);

			    });
			    usersList += "</dl>";
			    $('#container').html(usersList);
			    $('time').html('Ultima Actualizacion:' + data.time);
				});

			    function initialize() {
			        var myLatlng = new google.maps.LatLng(-25.2994321, -57.6063609);
			        var myOptions = {
			            zoom: 13,
			            center: myLatlng,
			            mapTypeId: google.maps.MapTypeId.ROADMAP
			        }
			        map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
			    }

			    // Function for adding a marker to the page.
			    function addMarker(ubica) {
			    	
			    	// alert (ubica);
			        marker = new google.maps.Marker({
			            position: ubica,
			            map: map,
			            title: 'Datos del Incidente'
			        });

			        /*Info windows sobre el marker (solo agrega al ultimo marker agregado)*/
			        // var infowindow = new google.maps.InfoWindow({
           //  			content: 'hola'
        			// });

			        // google.maps.event.addListener(marker, 'click', function() {
			        // infowindow.open(map,marker);
			        // });
			    }

				google.maps.event.addDomListener(window, 'load', initialize);

		</script> 

    </body>

</html>